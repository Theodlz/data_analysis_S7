# data_analysis_S7

Introduction (origin of the dataset, goal of the analysis and context):

In this data analysis project in python, we had to use the "household power consumption" dataset from ICS. This dataset contains different power consumption measures, sampled every minute. It contains : Global active power, Global reactive power, Global Intensity, Voltage, Sub_metering_1, Sub_metering_2 and Sub_metering_3. It also contains 2 time related variables : Date, and Time. The source is EDF, and the values correspond to the mean value of a minute. I contains values from december 2006 to december 2010, containing around 2 million rows.

The analysis has 2 goals : Solve a specific issue and display possible other usage of the dataset. 

The context is the following, we have to use the data of the power consumption of one household to be able to predict its consumption in the future. If it is possible, it will be highly useful for 2 reasons. First, for the household itself. For a household that use alternative source of energy as like solar panel, wind or geothermic, by predicting its future consumption, we can crossmatch the results with weather condition or other factor (or even only the consumption itself) to determine if they can afford to sell a part of the electricity they produce, without selling more than what they will use, and how much to sell. It will help them avoid to sell energy they would have used and having to buy energy from their supplier again, loosing their rentability or even rendering it negative. On the other side, if the supplier can forecast the power consumption of the households in its power grid, they can adapt their production in advance, therefor lowering costs of unnecessary production and avoiding shortage.

Also, we will have a look in specific time frames of our data, to see if we can predict/guess a family's habits just by looking at their consumption, which could fro example be a way to target them with appropriate adversiting at the appropriate time, or to automate the start and stop of certain appliances to improve the overall power consumption of the household. It would also suggest the need for the supplier to improve the security/privacy of this data to not accidentaly give informations about its consumers.



Preprocessing :
First thing we did was replacing every nan values. As the data is sampled per minute, we replaced every missing minute by the mean value of that minute of the day. 
Then, we grouped Date and Time in one variable DataTime to use it as a DateTime index. That way, we can resample our data in other time frame : per hour, per day, per week, per month...
We saved this cleaned dataset as ; dataset-treated.csv
Last but not least, we used Web scrapping to retrieve data online to add a temperature variable in our dataset, as we had the following hypothethis : As electric consumption seems to be seasonal, as well as the temperature, they should be correlated  (positively or negatively, but more probably negatively). We managed to retrieve daily min and max temperatures from info-climat.fr, from 2006 to 2010. The data comes from a weather station in Paris, which is not so far from Sceaux, where the household that serves as the source of this dataset is. We saved this temperature dataset as temperatures.csv


Imports : 
For the vizualisation we will be using mostly pandas and matplotlib, but we also used vacances-scolaires-france from PyPi to retrieve the dates of every holiday in France in the right zone (C), so we can differentiate measures during a normal week (business days+weekends) a holiday, in some of our plots.
For the modeling, we used Tensorflow for the LSTM models, sklearn for the Random Forest models, and statsmodels for the AR/ARIMA/SARIMA models.


Data Vizualisation:

In the first part our the data visualization, we started by visualizing all of our variables in different time resamplings (day, month, year...).

First we had quick look at the distributions of our variables. We did this just to try to see if there is any obvious anomalies or data that isn't relevant. Obviously the intensity is the same as the global active power, so we won't keep it for the rest of our analysis. The voltage is here centered our 245 and not the expected 230, so we discarded it too. The global reactive power's origin or meaning is unclear to us, so we didnt keep it. Also, the third sub metering seems to have a higher frequency of high values, which might indicate that the corresponding room (Water heating and AC) is more frequently active, which might mean that it is more responsible of the values and/or change in value of the Global Active power. As we can expect, the temperature is between -5 and 30 degrees Celsius.

Then we plotted 6 variables of interest  (the ones we will use in the models and the rest of our data analysis), in a very simple plot to see if we can observe obvious relationships. We can see that the temperature seems to be negatively correlated to the global active power measure, as well as the water heating + ac i.e a drop of temperature is an increase of global active power and water heating + AC, and vice versa. The temperature variable seem to be of importance.

We verified this with the next 3 plots, where we plotted those 3 variables 2 by 2. But beforehand we scaled them so we can compare their trend without looking at their difference in range of values. We can observe the temperature is indeed negatively correlated to both, and that the water heating + AC follows the same trend as the Global active power. The global active power being a sum of all its components (which are the 3 sub meterings and the remaining missing value), the water heating following the same evolution as the global active power could indicate that it is the variable responsible of the seasonal changes of the global active power. 

Next we used a correlation matrix on 5 variables : Global Active Power, sub metering 1,2 and 3, and the temperature. We plotted 3 matrix in different time frames : month, day, hour.
We can indeed observe that the temperature is the variable which is the most correlated to the Global Active power at a month scaled which makes sense as it is very likely to be a seasonal variable. We can also observe that this correlation diminishes as the time frame gets smaller. Which makes a lot of sense as daily temperature changes are less significant than monthly, and which makes even more sense for hourly data, as the temperature values we obtained are daily values, it doesnt explain the changes of consumption at the scale of an hour.
We can also see that sub metering 3 : Water heating + AC is as we thought, the variable most correlated to the Global Active Power. The 2 other submeterings (1: Kitchen, 2: laundry room) are also pretty correlated at a monthly scale but their correlation diminishes as the time frame get smaller, which is way less the case for the metering of the Water Heating + AC, that stays pretty much the same whatever the scale. That tells us that even on an hourly measure, it explains the variations of the global active power pretty well, as it seems to be responsible of most of its variations during a day, hour per hour.

Next, we moved onto the second part of our analysis, a focus on the global active power and a series of required graphs to apply time series models accordingly.

First, we plotted the daily moving average (with and sma of 7 days) on the whole dataset (4 years). We can clearly observe a yearly pattern, which indicates that the data is seasonal. For example, the pic of consumption happens between december and february when its the coldest temperatures of the year, and the lowest values are situated in july/august, when the temperatures are the highest and the household is very likely to leave for summer holidays. We can also observe sudden drops of consumption for a few days sometimes, which isnt an anomaly, it just corresponds to different holidays during which a family is likely to leave their house (to sky in february for example, or in November for the Toussaint holidays). We can also observe higher than normal measurings at the start of our dataset, but we will not analyse this anomaly further.

We proceeded to the Time series focused analysis of our Global Active Power variable as we would like to predict its values in our models, using past values.
In the following analysis, we resampled our values per week.

We started with a lag plot. A lag plot is a plot with the values at time t on the horizontal axis (x), and the values at time t+1 on the vertical axis (y). If the points seems to show a linear relationship (if they draw a line), it indicates that the values at time t, seem to be related to the values at time t+1. That indicates us that they are correlated, and that maybe we can use variables as time t to predict the variables at time t+1, which allows time preditions. 

To confirm this analysis of the lagplot, we used a corration matrix to show the correlation between values at time t and at time t+1. We can observe that at the wekly scale, they are related as high as 75%. it seems even more likely that we can use past values to predict current values, which means that we could use current values to predict future values (forecasting).

This analysis has one flaw, it shows the correlation only between the time t and t+1 (which also means between t-1 and t). We cannot observe if there is any relationship or correlation with different time delays, or multiple of them (example : see if the variable at time t, is explained/correlated to the one at time t-26 for example). That analysis is the one perfromed next using an auto correlation plot. The autocorrelation plot shows incremental lag values (forward which means that it starts with t, then t+1, t+2,.... until t+n) on the horizontal axis, and their correlation with the variable at time t on the vertical axis. It allows us the see the correlation at different lags. Here it is very interesting because it also shows a seasonal pattern. Correlation diminishes from its max value at t+1, to reach its minimum at t+26 (half of a year), and bounces back to another pic at t+52 (a full year). So we can see a yearly pattern of positive correlation, and a half yearly pattern (6 months = opposite time of the year =  summer/ winter or spring/fall) of negative correlation. To summarize this plot, we can say that is shows that the highest correlation is the one between t and t+1, but that as our data is seasonal, the values at t+n*26 and t+n*52 are also very correlated to the values at time t. We can therefore use those lag values in our time prediction models.
The highest correlation value of the autocorrelation plot will be the factor "p", that is the parameter of autocorrelation to use in auto regressive models (models that use the values a times t-n to predict values at time t)

But for some of our models that include a moving average model (that takes not values at time t-n but errors at time t-n to predict value of at time t), we also need another factor, "q", that is the partial auto correlation factor. For this we used a ACF, PACF plot which shows us 2 plots: autocorrelation for p (the same as the one we saw before), and partial autocorrelation for "q". Partial Autocorrelation shows the correlation between t and t+n, so the correlation between t and a value t+n lagged of n timestamps, but also taking into account the correlations in between them. Here, same as for p, we will choose a value of 1 for q as the highest correlation is between t and t+1. 
Those parameters p and q will be necessary for some of the statistical models we will use, as well as the seasonality every 52 weeks that we observed on the autocorrelation and moving average plot. 

The last part of our Data Visualization focuses not on the modeling, but on a different possible approach to this dataset : observing the evolution of values at smaller time scales to discover patterns, habits and usages of the member of the household, aka can we "spy" on someones daily life/routine just by looking at its electrical consumption ! If it is, a possible totally different project than ours could be using models that uses the power consumption to analyse a family's routine and tell what they are doing at a given time.

We started at a fairly large time scale (hourly) to show the electrical consumption of each submeterings : kitchen, laundry room and water heating + AC, hour bu hour, during both week days and business (we excluded holidays to exclude irregularities). it allows us to see pics of consumption that could display a specific behaviour. For example in the kitchen a pic between 7 and 9 and also in the evening, and for the water heating + AC a pic between 6 and 9 adn another pic in the evening too. Next, we focused on the time periods of those 2 morning high values to see if we can draw any conclusions.

When plotting submetering 1 and 3 between 6 and 9 minute per minute am we can clearly observe:
For the kitchen, a pic 8.10 and 8.30, which can correspond to the time at which they take their breakfast during the week. Whereas during the weekend the power consumption doesnt really go up that much and during a specific time frame, which means that the family probably takes their breakfast either not all together at the same time, or later during the day. We can easily find this out by looking at a time frame after 9 AM.
For the Water Heating, we can observe that its value increases starting around 6.15 to reach  its max value at 8.10, exactly when the pic in the kitchen occurs. We can say with confidence that it means that the family members shower in the morning before taking their breakfast. Indeed, as the Water heating get emptied of its warm water as it is getting used, the water gets replaced by colder water gradually, lowering its temperature more and more. Therefor, its electric consumption increases more and more to compensate for this lowering of the temperature to try to get it back to its max temperature as fast as it can. And when no more cold water gets int he system, its electric consumption stops increasing and starts to lower as it needs less power to heat the water that is getting hot instead of getting colder with new water.

Also look at those 2 curves, we can see that we could have guessed to which appliance/room each submetering corresponds too. First because of the times at which they are used. But also and mostly because of how they behave. Indeed, the consumption of a water heater increases and decreases continuously as the water gets emptied and refilled linearly, whereas the consumption of appliances in kitchen are rather "binary" as they are just on or off, and set on incremental level of power, not continuous. 


Conclusion: What did we learn ?

About the problematic itself, we confirmed that it is possible to predict the electric consumption using different models in different time frames, both short term and long term, which solves both issues mentionned in the introduction. The modeling part of the project is a success and has solid bases and justification thanks to our time series analysis. Moreover, we observed that it is possible to look at the electrical consumption in detail to display hypothetic behavior of the members of an household.


